<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Layered Monolith — демонстрація</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f9f9f9;
        margin: 0;
        padding: 20px;
    }
    h1 { text-align: center; color: #333; }
    .container { display: flex; gap: 20px; margin-top: 20px; }
    .left, .right { background: #fff; padding: 20px; border-radius: 8px; flex: 1; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    button { padding: 8px 15px; margin-top: 5px; cursor: pointer; background: #2c7be5; color: #fff; border: none; border-radius: 4px; }
    button:hover { background: #1a5bb8; }
    input { width: calc(100% - 20px); padding: 8px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
    pre { background: #222; color: #0f0; padding: 10px; border-radius: 4px; overflow-x: auto; max-height: 300px; }
    h3 { margin-top: 0; }
</style>
</head>
<body>

<h1>Layered Monolith — демонстраційна реалізація</h1>
<p style="text-align:center;">Архітектура: <b>presentation → application → domain → infrastructure</b>. Збереження даних через localStorage.</p>

<div class="container">
    <div class="left">
        <h3>API</h3>
        <button id="healthBtn">GET /health</button><br>
        <button id="listBtn">GET /products</button><br><br>

        <input type="text" id="nameInput" placeholder="Назва продукту">
        <input type="number" id="priceInput" placeholder="Ціна">
        <button id="createBtn">POST /products</button><br><br>

        <h3>Результат</h3>
        <pre id="result">{ "status": 200, "body": [] }</pre>
        <button id="clearBtn">Очистити localStorage</button>
    </div>

    <div class="right">
        <h3>Архітектурні шари</h3>
        <strong>Domain</strong>
        <pre>
{
    Product,
    ValidationError
}
        </pre>
        <strong>Application</strong>
        <pre>
{
    CreateProduct,
    ListProducts
}
        </pre>
        <strong>Infrastructure</strong>
        <pre>
{
    LocalStorageProductRepository
}
        </pre>
        <strong>Presentation</strong>
        <pre>
{
    ApiController
}
        </pre>
    </div>
</div>

<script>
// ================= Domain =================
class Product {
    constructor(id, name, price) {
        if(!name || !name.trim()) throw new Error("Name must not be empty");
        if(price <= 0) throw new Error("Price must be positive");
        this.id = id;
        this.name = name;
        this.price = price;
    }
}

// ================= Infrastructure =================
class LocalStorageProductRepository {
    constructor() {
        this.key = "products";
        this._load();
    }

    _load() {
        const data = localStorage.getItem(this.key);
        this.products = data ? JSON.parse(data) : [];
        this.nextId = this.products.length ? Math.max(...this.products.map(p=>p.id)) +1 : 1;
    }

    _save() {
        localStorage.setItem(this.key, JSON.stringify(this.products));
    }

    create(product) {
        product.id = this.nextId++;
        this.products.push(product);
        this._save();
        return product;
    }

    list() {
        this._load();
        return this.products;
    }

    clear() {
        localStorage.removeItem(this.key);
        this._load();
    }
}

// ================= Application =================
class CreateProduct {
    constructor(repo){ this.repo = repo; }
    execute(dto){
        const product = new Product(null, dto.name, dto.price);
        return this.repo.create(product);
    }
}

class ListProducts {
    constructor(repo){ this.repo = repo; }
    execute(){ return this.repo.list(); }
}

// ================= Presentation =================
const repo = new LocalStorageProductRepository();
const createUC = new CreateProduct(repo);
const listUC = new ListProducts(repo);

const resultEl = document.getElementById("result");

document.getElementById("healthBtn").addEventListener("click", ()=>{
    resultEl.textContent = JSON.stringify({status:200}, null, 2);
});

document.getElementById("listBtn").addEventListener("click", ()=>{
    resultEl.textContent = JSON.stringify({status:200, body: listUC.execute()}, null, 2);
});

document.getElementById("createBtn").addEventListener("click", ()=>{
    const name = document.getElementById("nameInput").value;
    const price = parseFloat(document.getElementById("priceInput").value);
    try {
        const product = createUC.execute({name, price});
        resultEl.textContent = JSON.stringify({status:201, body: product}, null, 2);
    } catch(e){
        resultEl.textContent = "Error: " + e.message;
    }
});

document.getElementById("clearBtn").addEventListener("click", ()=>{
    repo.clear();
    resultEl.textContent = JSON.stringify({status:200, body: []}, null, 2);
});
</script>

</body>
</html>
